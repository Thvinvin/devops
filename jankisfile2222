pipeline {
    agent any

    parameters {
        string(name: 'Nom', defaultValue: '', description: 'Entrez votre nom')
        string(name: 'PrÃ©nom', defaultValue: '', description: 'Entrez votre prÃ©nom')

        // Liste dÃ©roulante pour le mois
        choice(name: 'Mois de naissance', choices: ['JANVIER', 'FEVRIER', 'MARS', 'AVRIL', 'MAI', 'JUIN', 'JUILLET', 'AOUT', 'SEPTEMBRE', 'OCTOBRE', 'NOVEMBRE', 'DECEMBRE'], description: 'SÃ©lectionnez votre mois de naissance')

        // Liste dÃ©roulante pour le jour (gÃ©nÃ©rÃ©e dynamiquement)
        activeChoice(name: 'Jour de naissance') {
            groovyScript {
                script = '''
                    def daysInMonth = [JANVIER: 31, FEVRIER: 28, MARS: 31, AVRIL: 30, MAI: 31, JUIN: 30, JUILLET: 31, AOUT: 31, SEPTEMBRE: 30, OCTOBRE: 31, NOVEMBRE: 30, DECEMBRE: 31]
                    def month = params['Mois de naissance']
                    (1..daysInMonth[month]).collect { it.toString().padLeft(2, '0') }
                '''
            }
        }

        // Liste dÃ©roulante pour l'annÃ©e
        choice(name: 'AnnÃ©e de naissance', choices: (1900..2025).collect { it.toString() }.reverse(), description: 'SÃ©lectionnez votre annÃ©e de naissance')

        // Date actuelle
        choice(name: 'Mois Actuel', choices: ['JANVIER', 'FEVRIER', 'MARS', 'AVRIL', 'MAI', 'JUIN', 'JUILLET', 'AOUT', 'SEPTEMBRE', 'OCTOBRE', 'NOVEMBRE', 'DECEMBRE'], description: 'SÃ©lectionnez le mois actuel')
        activeChoice(name: 'Jour Actuel') {
            groovyScript {
                script = '''
                    def daysInMonth = [JANVIER: 31, FEVRIER: 28, MARS: 31, AVRIL: 30, MAI: 31, JUIN: 30, JUILLET: 31, AOUT: 31, SEPTEMBRE: 30, OCTOBRE: 31, NOVEMBRE: 30, DECEMBRE: 31]
                    def month = params['Mois Actuel']
                    (1..daysInMonth[month]).collect { it.toString().padLeft(2, '0') }
                '''
            }
        }
    }

    stages {
        stage('VÃ©rification Anniversaire') {
            steps {
                script {
                    def today = "${params.'Jour Actuel'}"
                    def month = "${params.'Mois Actuel'}"
                    def birthDay = "${params.'Jour de naissance'}"
                    def birthMonth = "${params.'Mois de naissance'}"
                    def birthYear = "${params.'AnnÃ©e de naissance'}"
                    def currentYear = new Date().format('yyyy').toInteger()

                    if ((today == birthDay) && (month == birthMonth)) {
                        echo "ðŸŽ‰ Joyeux Anniversaire ${params.PrÃ©nom} ${params.Nom} ! Tu as maintenant ${currentYear - birthYear.toInteger()} ans ! ðŸŽ‚"
                    } else {
                        echo "Ce n'est pas encore ton anniversaire."
                    }
                }
            }
        }

        stage('Objectifs Mensuels') {
            parallel {
                stage('Objectifs de Janvier') {
                    steps {
                        script {
                            checkMonthlyObjectives('JANVIER')
                        }
                    }
                }
                stage('Objectifs de FÃ©vrier') {
                    steps {
                        script {
                            checkMonthlyObjectives('FEVRIER')
                        }
                    }
                }
                stage('Objectifs de Mars') {
                    steps {
                        script {
                            checkMonthlyObjectives('MARS')
                        }
                    }
                }
                // Ajoutez d'autres mois ici si nÃ©cessaire
            }
        }
    }

    post {
        always {
            cleanWs() // Nettoyage du workspace aprÃ¨s chaque exÃ©cution
        }
    }
}

def checkMonthlyObjectives(String month) {
    def dayInt = params.'Jour Actuel'.toInteger()
    def daysInMonth = [JANVIER: 31, FEVRIER: 28, MARS: 31, AVRIL: 30, MAI: 31,
                       JUIN: 30, JUILLET: 31, AOUT: 31, SEPTEMBRE: 30,
                       OCTOBRE: 31, NOVEMBRE: 30, DECEMBRE: 31]

    if (month == params.'Mois Actuel') {
        if (dayInt >= 1 && dayInt <= daysInMonth[month]) {
            echo "Voici vos objectifs pour ${month} :"
            switch (month) {
                case "JANVIER":
                    echo "- Reconstruire l'arrÃªt de bus."
                    echo "- Identifier les lignes de bus Ã  proximitÃ©."
                    break
                case "FEVRIER":
                    echo "- Obtenir le CCNA Ã  97%."
                    echo "- Ajouter une adresse IP sur le switch."
                    break
                case "MARS":
                    echo "- Reconstruire le lit de Martin."
                    break
                default:
                    echo "Aucun objectif dÃ©fini pour ce mois."
            }
        } else {
            echo "Le jour actuel est en dehors des limites du mois."
        }
    } else {
        echo "Ce n'est pas le mois correspondant Ã  vos objectifs."
    }
}
